<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diagn√≥stico Completo del Sistema de Voz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            margin: 10px 0;
            padding: 10px;
            border-left: 4px solid #ddd;
        }
        .test-pass {
            border-left-color: #4CAF50;
            background-color: #f1f8f4;
        }
        .test-fail {
            border-left-color: #f44336;
            background-color: #fff3f3;
        }
        .test-pending {
            border-left-color: #ff9800;
            background-color: #fff8e1;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background-color: #2196F3;
            color: white;
            font-size: 16px;
        }
        button:hover {
            background-color: #1976D2;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .console {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .console-line {
            margin: 2px 0;
        }
        #main-orb {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: radial-gradient(circle, #00BFFF, #8A2BE2);
            margin: 20px auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: transform 0.3s;
        }
        #main-orb:hover {
            transform: scale(1.1);
        }
        #main-orb.listening {
            animation: pulse 1s infinite alternate;
        }
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.15); }
        }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico Completo del Sistema de Voz</h1>
    
    <div class="test-section">
        <h2>1. Compatibilidad del Navegador</h2>
        <div id="browser-tests"></div>
    </div>
    
    <div class="test-section">
        <h2>2. S√≠ntesis de Voz (Text-to-Speech)</h2>
        <button onclick="testSynthesis()">Probar S√≠ntesis de Voz</button>
        <div id="synthesis-test" class="test-item test-pending">Esperando prueba...</div>
    </div>
    
    <div class="test-section">
        <h2>3. Reconocimiento de Voz (Speech-to-Text)</h2>
        <button onclick="testRecognition()">Probar Reconocimiento</button>
        <div id="main-orb">Click aqu√≠</div>
        <div id="recognition-test" class="test-item test-pending">Esperando prueba...</div>
        <div class="console" id="recognition-console"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Prueba de Comandos</h2>
        <p>Despu√©s de activar el reconocimiento, prueba estos comandos:</p>
        <ul>
            <li><strong>"Hola"</strong> - Deber√≠a saludar</li>
            <li><strong>"¬øQu√© ves?"</strong> - Deber√≠a describir objetos</li>
            <li><strong>"¬øCu√°nto cuesta el agua?"</strong> - Deber√≠a dar un precio</li>
            <li><strong>"¬øC√≥mo llegar al supermercado?"</strong> - Deber√≠a dar direcciones</li>
            <li><strong>"Ayuda"</strong> - Deber√≠a explicar funciones</li>
        </ul>
        <div id="commands-test" class="test-item test-pending">Esperando comandos...</div>
    </div>
    
    <div class="test-section">
        <h2>5. Consola de Eventos</h2>
        <div class="console" id="event-console"></div>
    </div>

    <script>
        // Variables globales
        let recognition = null;
        let synth = window.speechSynthesis;
        let isListening = false;
        
        // Logging
        function log(message, target = 'event-console') {
            console.log(message);
            const console = document.getElementById(target);
            const line = document.createElement('div');
            line.className = 'console-line';
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        }
        
        // Actualizar estado de prueba
        function updateTestStatus(testId, status, message) {
            const element = document.getElementById(testId);
            element.className = `test-item test-${status}`;
            element.textContent = message;
        }
        
        // 1. Verificar compatibilidad del navegador
        function checkBrowserCompatibility() {
            const tests = document.getElementById('browser-tests');
            
            // Test 1: Navegador
            const browserTest = document.createElement('div');
            browserTest.className = 'test-item';
            const userAgent = navigator.userAgent;
            if (userAgent.includes('Chrome') || userAgent.includes('Edge')) {
                browserTest.className += ' test-pass';
                browserTest.textContent = '‚úì Navegador compatible (Chrome/Edge)';
            } else {
                browserTest.className += ' test-fail';
                browserTest.textContent = '‚úó Navegador no recomendado (usa Chrome o Edge)';
            }
            tests.appendChild(browserTest);
            
            // Test 2: Speech Synthesis API
            const synthTest = document.createElement('div');
            synthTest.className = 'test-item';
            if ('speechSynthesis' in window) {
                synthTest.className += ' test-pass';
                synthTest.textContent = '‚úì API de s√≠ntesis de voz disponible';
            } else {
                synthTest.className += ' test-fail';
                synthTest.textContent = '‚úó API de s√≠ntesis de voz NO disponible';
            }
            tests.appendChild(synthTest);
            
            // Test 3: Speech Recognition API
            const recogTest = document.createElement('div');
            recogTest.className = 'test-item';
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                recogTest.className += ' test-pass';
                recogTest.textContent = '‚úì API de reconocimiento de voz disponible';
            } else {
                recogTest.className += ' test-fail';
                recogTest.textContent = '‚úó API de reconocimiento de voz NO disponible';
            }
            tests.appendChild(recogTest);
            
            // Test 4: MediaDevices API
            const mediaTest = document.createElement('div');
            mediaTest.className = 'test-item';
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                mediaTest.className += ' test-pass';
                mediaTest.textContent = '‚úì API de dispositivos multimedia disponible';
            } else {
                mediaTest.className += ' test-fail';
                mediaTest.textContent = '‚úó API de dispositivos multimedia NO disponible';
            }
            tests.appendChild(mediaTest);
            
            // Test 5: HTTPS
            const httpsTest = document.createElement('div');
            httpsTest.className = 'test-item';
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                httpsTest.className += ' test-pass';
                httpsTest.textContent = '‚úì Conexi√≥n segura (HTTPS o localhost)';
            } else {
                httpsTest.className += ' test-fail';
                httpsTest.textContent = '‚úó Se requiere HTTPS para el micr√≥fono';
            }
            tests.appendChild(httpsTest);
        }
        
        // 2. Probar s√≠ntesis de voz
        function testSynthesis() {
            log('Probando s√≠ntesis de voz...');
            
            try {
                const text = 'Hola, esta es una prueba de s√≠ntesis de voz. Si puedes escuchar esto, la s√≠ntesis funciona correctamente.';
                
                if (synth.speaking) {
                    synth.cancel();
                }
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 1.0;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                
                utterance.onstart = () => {
                    log('S√≠ntesis iniciada');
                    updateTestStatus('synthesis-test', 'pending', 'üîä Hablando...');
                };
                
                utterance.onend = () => {
                    log('S√≠ntesis completada');
                    updateTestStatus('synthesis-test', 'pass', '‚úì S√≠ntesis de voz funcionando correctamente');
                };
                
                utterance.onerror = (event) => {
                    log(`Error en s√≠ntesis: ${event.error}`);
                    updateTestStatus('synthesis-test', 'fail', `‚úó Error: ${event.error}`);
                };
                
                synth.speak(utterance);
            } catch (error) {
                log(`Excepci√≥n en s√≠ntesis: ${error.message}`);
                updateTestStatus('synthesis-test', 'fail', `‚úó Excepci√≥n: ${error.message}`);
            }
        }
        
        // 3. Probar reconocimiento de voz
        function testRecognition() {
            log('Iniciando prueba de reconocimiento...');
            startListening();
        }
        
        // Inicializar reconocimiento
        function initRecognition() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                updateTestStatus('recognition-test', 'fail', '‚úó Reconocimiento no soportado');
                return false;
            }
            
            recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'es-ES';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                isListening = true;
                log('Reconocimiento iniciado - ¬°Habla ahora!', 'recognition-console');
                updateTestStatus('recognition-test', 'pending', 'üé§ Escuchando... Di algo');
                document.getElementById('main-orb').classList.add('listening');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                const confidence = Math.round(event.results[0][0].confidence * 100);
                log(`Escuch√©: "${transcript}" (confianza: ${confidence}%)`, 'recognition-console');
                updateTestStatus('recognition-test', 'pass', `‚úì Reconoc√≠: "${transcript}"`);
                
                // Procesar comando
                processTestCommand(transcript.toLowerCase());
            };
            
            recognition.onend = () => {
                isListening = false;
                log('Reconocimiento finalizado', 'recognition-console');
                document.getElementById('main-orb').classList.remove('listening');
            };
            
            recognition.onerror = (event) => {
                isListening = false;
                log(`Error: ${event.error}`, 'recognition-console');
                updateTestStatus('recognition-test', 'fail', `‚úó Error: ${event.error}`);
                document.getElementById('main-orb').classList.remove('listening');
            };
            
            return true;
        }
        
        // Iniciar escucha
        function startListening() {
            if (!recognition) {
                if (!initRecognition()) {
                    return;
                }
            }
            
            try {
                recognition.start();
            } catch (err) {
                log(`Error al iniciar: ${err.message}`, 'recognition-console');
                if (err.name === 'InvalidStateError') {
                    recognition.stop();
                    setTimeout(() => recognition.start(), 100);
                }
            }
        }
        
        // Procesar comandos de prueba
        function processTestCommand(command) {
            log(`Procesando comando: "${command}"`);
            let response = '';
            
            if (command.includes('hola')) {
                response = 'Hola, soy tu asistente. ¬øEn qu√© puedo ayudarte?';
                updateTestStatus('commands-test', 'pass', '‚úì Comando "hola" funcionando');
            } else if (command.includes('qu√© ves') || command.includes('que ves')) {
                response = 'Veo una habitaci√≥n con buena iluminaci√≥n. Puedo detectar objetos cuando actives la c√°mara.';
                updateTestStatus('commands-test', 'pass', '‚úì Comando "qu√© ves" funcionando');
            } else if (command.includes('precio')) {
                response = 'El precio del agua es 1.50 euros.';
                updateTestStatus('commands-test', 'pass', '‚úì Comando de precio funcionando');
            } else if (command.includes('c√≥mo llegar') || command.includes('como llegar')) {
                response = 'Para llegar al supermercado: sal de casa, gira a la derecha, camina 100 metros hasta el sem√°foro.';
                updateTestStatus('commands-test', 'pass', '‚úì Comando de navegaci√≥n funcionando');
            } else if (command.includes('ayuda')) {
                response = 'Puedo reconocer objetos, leer precios, darte indicaciones y detectar billetes.';
                updateTestStatus('commands-test', 'pass', '‚úì Comando de ayuda funcionando');
            } else {
                response = 'No entend√≠ tu comando. Prueba con: hola, qu√© ves, precio, o ayuda.';
            }
            
            // Hablar la respuesta
            if (response) {
                const utterance = new SpeechSynthesisUtterance(response);
                utterance.lang = 'es-ES';
                synth.speak(utterance);
                log(`Respuesta: ${response}`);
            }
        }
        
        // Event listeners
        document.getElementById('main-orb').addEventListener('click', () => {
            log('Click en el orbe');
            startListening();
        });
        
        // Verificar compatibilidad al cargar
        window.addEventListener('DOMContentLoaded', () => {
            log('P√°gina cargada - Iniciando diagn√≥stico');
            checkBrowserCompatibility();
            
            // Listar voces disponibles
            setTimeout(() => {
                const voices = synth.getVoices();
                const spanishVoices = voices.filter(v => v.lang.includes('es'));
                log(`Voces en espa√±ol disponibles: ${spanishVoices.length}`);
                spanishVoices.forEach(v => {
                    log(`  - ${v.name} (${v.lang})`);
                });
            }, 1000);
        });
        
        // Atajo de teclado
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' && !isListening) {
                event.preventDefault();
                log('Barra espaciadora presionada');
                startListening();
            }
        });
    </script>
</body>
</html> 